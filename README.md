<!-- 














  ** DO NOT EDIT THIS FILE
  ** 
  ** This file was automatically generated by the `build-harness`. 
  ** 1) Make all changes to `README.yaml` 
  ** 2) Run `make init` (you only need to do this once)
  ** 3) Run`make readme` to rebuild this file. 
  **
  ** (We maintain HUNDREDS of open source projects. This is how we maintain our sanity.)
  **















  -->

# ansible-cloudflared


This ansible role installs cloudflared and configures for use with argo tunnel.


---


This project is part of the [Guardian Project Ops](https://gitlab.com/guardianproject-ops/) collection.







It's free and open source made available under the the [GNU Affero General Public v3 License](LICENSE.md).






## Requirements

This role only supports Debian hosts.

## Usage




### When provisioning the argo cert manually

You'll have to login to the server, do a `cloudflared login` and copy the
resulting cert into position in `/etc/cloudflared/app.cert`

```yaml
- hosts: servers
  vars:
    cloudflared_tunnels:
      - tunnel_name: app
        tunnel_hostname: app.example.com
        tunnel_upstream: 127.0.0.1:80
  roles:
    - ansible-cloudflared
```

### When provisioning the argo cert automatically:

This automatically provisions the cert but requires root creds :yikes:

```yaml
- hosts: servers
  vars:
    cloudflare_origin_ca_key: "{{ lookup('env', 'CLOUDFLARE_ORIGIN_CA_KEY') }}"
    cloudflare_auth_key: "{{ lookup('env', 'CLOUDFLARE_AUTH_KEY') }}"
    cloudflare_auth_email: "{{ lookup('env', 'CLOUDFLARE_AUTH_EMAIL') }}"
    cloudflare_zone_id: "{{ lookup('env', 'CLOUDFLARE_ZONE_ID') }}"
    cloudflared_argo_provision_enabled: true
    cloudflared_tunnels:
      - tunnel_name: app
        tunnel_hostname: app.example.com
        tunnel_upstream: 127.0.0.1:80
  roles:
    - ansible-cloudflared
```






## Role Variables

* `cloudflared_base_url`: `"https://bin.equinox.io/c/VdrWdbjqyF/"` - upstream url to download cloudflared from



* `cloudflared_amd64_apt`: `"cloudflared-stable-linux-amd64.deb"` - the name of the deb package to install



* `cloudflared_bin_location`: `/usr/local/bin` - the location the cloudflared binary will be placed



* `cloudflared_enable_service`: `true` - whether the cloudflared argo tunnel service will be started



* `cloudflared_tunnels`: `[]` - the tunnels to create


  cloudflared_tunnels:
   - tunnel_name: foo
     tunnel_hostname: yourapp.foo.com
     tunnel_upstream: 127.0.0.1:8001

* `cloudflared_argo_provision_enabled`: `false` - Whether to provision the argo cert automatically



* `cloudflare_origin_ca_key`: `undefined` - Used to provision the argo tunnel cert.



* `cloudflare_auth_key`: `undefined` - Used to provision the argo tunnel cert.



* `cloudflare_auth_email`: `undefined` - Used to provision the argo tunnel cert.



* `cloudflare_zone_id`: `undefined` - Used to provision the argo tunnel cert.






## Help

File an [issue](https://gitlab.com/guardianproject-ops/ansible-cloudflared/issues), send us an [email][email] or join us in the Matrix 'verse at [#guardianproject:matrix.org][matrix] or IRC at `#guardianproject` on Freenode.

## Contributing

### Bug Reports & Feature Requests

Please use the [issue tracker](https://gitlab.com/guardianproject-ops/ansible-cloudflared/issues) to report any bugs or file feature requests.

### Developing

If you are interested in becoming a contributor, want to get involved in
developing this project, other projects, or want to [join our team][join], we
would love to hear from you! Shoot us an [email][join-email].

In general, PRs are welcome. We follow the typical "fork-and-pull" Git workflow.

 1. **Fork** the repo on GitLab
 2. **Clone** the project to your own machine
 3. **Commit** changes to your own branch
 4. **Push** your work back up to your fork
 5. Submit a **Merge Request** so that we can review your changes

**NOTE:** Be sure to merge the latest changes from "upstream" before making a pull request!

## Credits & License 


Copyright Â© 2017-2020 [Guardian Project][website]












[![License: AGPL v3](https://img.shields.io/badge/License-AGPL%20v3-blue.svg)](https://www.gnu.org/licenses/agpl-3.0.en.html)

    GNU AFFERO GENERAL PUBLIC LICENSE
    Version 3, 19 November 2007

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.


See [LICENSE.md](LICENSE.md) for full details.

## Trademarks

All other trademarks referenced herein are the property of their respective owners.

## About

**This project is maintained and funded by [The Guardian Project][website].**

[<img src="https://gitlab.com/guardianproject/guardianprojectpublic/-/raw/master/Graphics/GuardianProject/pngs/logo-black-w256.png"/>][website]

We're a [collective of designers and developers][website] focused on useable
privacy and security. Everything we do is 100% FOSS. Check out out other [ops
projects][gitlab] and [non-ops projects][nonops], follow us on
[mastadon][mastadon] or [twitter][twitter], [apply for a job][join], or
[partner with us][partner].



**This project is also funded by the [Center for Digital Resilience][cdr].**

[<img src="https://gitlab.com/digiresilience/web/digiresilience.org/-/raw/master/assets/images/cdr-logo-gray-256w.png"/>][website]

CDR builds [resilient systems][cdr-tech] to keep civil society safe online and empowers
activists to regain civic space. We offer a variety of digital wellness
services through local partner organizations. Interested? [Email
us][cdr-email].




### Contributors

|  [![Abel Luck][abelxluck_avatar]][abelxluck_homepage]<br/>[Abel Luck][abelxluck_homepage] |
|---|

  [abelxluck_homepage]: https://gitlab.com/abelxluck

  [abelxluck_avatar]: https://secure.gravatar.com/avatar/0f605397e0ead93a68e1be26dc26481a?s=100&amp;d=identicon





[logo-square]: https://assets.gitlab-static.net/uploads/-/system/group/avatar/3262938/guardianproject.png?width=88
[logo]: https://guardianproject.info/GP_Logo_with_text.png
[join]: https://guardianproject.info/contact/join/
[website]: https://guardianproject.info
[cdr]: https://digiresilience.org
[cdr-tech]: https://digiresilience.org/tech/
[matrix]: https://riot.im/app/#/room/#guardianproject:matrix.org
[join-email]: mailto:jobs@guardianproject.info
[email]: mailto:support@guardianproject.info
[cdr-email]: mailto:info@digiresilience.org
[twitter]: https://twitter.com/guardianproject
[mastadon]: https://social.librem.one/@guardianproject
[gitlab]: https://gitlab.com/guardianproject-ops
[nonops]: https://gitlab.com/guardianproject
[partner]: https://guardianproject.info/how-you-can-work-with-us/
